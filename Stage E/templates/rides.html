<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rides</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
{% if js_alert %}
<script>
    alert("{{ js_alert }}");
</script>
{% endif %}

<div class="header">
    <a href="/">
        <img src="{{ url_for('static', filename='images/logo-Sh.png') }}" alt="Logo" class="logo">
    </a>
    <h2 style="text-align:center; color: #dc3545">Rides</h2>
    <div class="nav-buttons">
        <a href="{{ url_for('volunteers') }}" class="nav-button">Volunteers</a>
        <a href="{{ url_for('volunteering') }}" class="nav-button">Volunteering</a>
        <a href="{{ url_for('rides') }}" class="nav-button">Rides</a>
    </div>
</div>

<!-- טופס חיפוש/עדכון/מחיקה -->
<form method="POST" action="{{ url_for('rides') }}" class="volunteer-form-grid" id="rideForm">
    <input type="hidden" name="volunteering_id" id="volunteering_id"
           value="{{ ride_data.volunteering_id if ride_data else '' }}">

    <div class="form-top-bar">
        <div class="form-info-text">
            To search or update a ride, please select destination and driver, and enter pickup time.
        </div>
        <div class="form-buttons-row">
            {% if ride_data %}
                <button type="submit" name="action" value="update" class="update-button">Update</button>
                <button type="submit" name="action" value="delete" class="update-button"
                        onclick="return confirm('Are you sure you want to delete this ride?');">
                    Delete
                </button>
            {% else %}
                <button type="submit" name="action" value="search" class="update-button">Search</button>
            {% endif %}
            <button type="button" class="update-button" onclick="clearForm()">Clear</button>
        </div>
    </div>

    <div class="form-field">
        <label>Pickup Time</label>
        <input type="time" name="pickup_time" id="pickup_time"
               value="{{ ride_data.pickup_time if ride_data else '' }}" required>
    </div>

    <div class="form-field">
        <label for="destination">Destination:</label>
        <select name="destination" id="destination" required>
            <option value="" disabled {% if not selected_destination %}selected{% endif %} hidden>Select destination</option>
            {% for d in destinations %}
            {% set val = d[0] ~ '|' ~ d[1] ~ '|' ~ d[2] %}
            <option value="{{ val }}" {% if selected_destination== val %}selected{% endif %}>
                {{ d[0] }} ({{ d[1] }}, {{ d[2] }})
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="form-field">
        <label>Driver</label>
        <select name="driver_id" id="driver_id" required>
            <option value="" disabled hidden {% if not ride_data %}selected{% endif %}>Select driver</option>
            {% for d in available_drivers %}
            <option value="{{ d[0] }}" {% if ride_data and ride_data.driver_id== d[0] %}selected{% endif %}>
                {{ d[0] }} - {{ d[1] }} {{ d[2] }}
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="form-field">
        <label>Vehicle</label>
        <select name="vehicle_id" id="vehicle_id" required {% if not ride_data %}disabled{% endif %}>
            {% for v in available_vehicles %}
            <option value="{{ v[0] }}" {% if ride_data and ride_data.vehicle_id== v[0] %}selected{% endif %}>
                {{ v[0] }} - {{ v[1] }} ({{ v[2] }}, {{ v[3] }} seats)
            </option>
            {% endfor %}
        </select>
    </div>

    <div class="form-field">
        <label>Assistant (optional)</label>
        <select name="assistant_id" id="assistant_id" {% if not ride_data %}disabled{% endif %}>
            <option value="">-- None --</option>
            {% for a in available_assistants %}
            <option value="{{ a[0] }}" {% if ride_data and ride_data.assistant_id== a[0] %}selected{% endif %}>
                {{ a[0] }} - {{ a[1] }} {{ a[2] }}
            </option>
            {% endfor %}
        </select>
    </div>
</form>

<!-- טבלת נסיעות -->
<div class="scroll-table-wrapper" style="height: 350px">
    <table class="scroll-table">
        <thead>
        <tr>
            <th>Volunteering ID</th>
            <th>Pickup Time</th>
            <th>Destination Name</th>
            <th>Destination Address</th>
            <th>Vehicle ID</th>
            <th>Driver ID</th>
            <th>Assistant ID</th>
        </tr>
        </thead>
        <tbody>
        {% for r in rides %}
        <tr>
            {% for item in r %}
            <td>{{ item }}</td>
            {% endfor %}
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- JavaScript -->
<script>
    function clearForm() {
        document.getElementById("rideForm").reset();
        window.location.href = "{{ url_for('rides') }}";
    }
</script>
</body>
</html>
